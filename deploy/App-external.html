<!DOCTYPE html>
<html>
<head>
    <title>Random App Name87393</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",itemId:"pulldown-container",layout:{type:"hbox",align:"stretch"}},{xtype:"container",itemId:"text-container",layout:{type:"anchor",align:"stretch"}}],launch:function(){console.log("Basic Rally Grid"),this._loadIterations()},_loadIterations:function(){var iterPicker={xtype:"rallyiterationcombobox",itemId:"iter-picker",fieldLabel:"Iteration",labelAlign:"right",width:"300",listeners:{ready:this._loadData,select:this._loadData,scope:this}};this.down("#pulldown-container").add(iterPicker)},_getFilters:function(iterVal){var iterationFilter=Ext.create("Rally.data.wsapi.Filter",{property:"Iteration",operation:"=",value:iterVal});return iterationFilter},_loadData:function(){var iterRef=this.down("#iter-picker").getRecord().get("_ref");console.log("iter ref: ",iterRef);var comboFilter=this._getFilters(iterRef);this.myStore?(this.myStore.setFilter(comboFilter),this.myStore.load()):(this.myStore=Ext.create("Rally.data.wsapi.artifact.Store",{models:["User Story","Defect"],autoLoad:!0,filters:comboFilter,listeners:{load:function(store,data,success){console.log();var htmlStr=this._getArtifactHtml(store.getRecords());this.mytext||this._createText(htmlStr),this._setText(htmlStr)},scope:this},fetch:["FormattedID","Name","Owner","ScheduleState","PlanEstimate","RevisionHistory"]}),console.log("myStore: ",this.myStore))},_createText:function(string){this.mytext={itemId:"texted",xtype:"rallyrichtexteditor",value:string,style:{width:"100%",height:"100%"}},this.down("#text-container").add(this.mytext)},_setText:function(string){this.down("#texted").setValue(string)},_getArtifactHtml:function(records){var htmlStr="";return Ext.Array.each(records,function(rec){pEst=rec.get("PlanEstimate"),schState=rec.get("ScheduleState"),recStr=rec.get("FormattedID")+": "+rec.get("Name"),console.log("ART_HTML: ",pEst),pEst&&pEst>0?recStr=recStr+" ("+pEst+"pts)":schState&&"Incomplete"==schState&&(console.log("REV: ",rec.get("RevisionHistory")),recStr=recStr+" ("+pEst+"pts)"),htmlStr="Accepted"==schState||"Completed"==schState?htmlStr+'<font color="green">'+recStr+"</font><BR>":"Incomplete"==schState?htmlStr+'<font color="red">'+recStr+"</font><BR>":htmlStr+recStr+"<BR>"}),htmlStr}});

            Rally.launchApp('CustomApp', {
                name:"Random App Name87393",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
